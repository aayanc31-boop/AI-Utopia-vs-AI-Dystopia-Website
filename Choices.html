<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Choices</title>
  <link rel="stylesheet" href="style.css">
  
</head>
<body>


  <nav class="navbar">
    <ul>
      <li><a href="Home.html" >Home</a></li>
      <li><a href="System.html" >Utopia</a></li>
      <li><a href="City.html" >Dystopia</a></li>
      <li><a href="Choices.html" >Choices</a></li>
      <li><a href="Ethics.html" >Ethics</a></li>
    </ul>
  </nav>

<div class="choices-background"></div>
<div class="choices-content">

    <h1 class="site-title" id="toggle-btn">Choices</h1>

<style>

.site-title {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: clamp(2rem, 8vw, 6rem);
     text-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
    color: white;
    font-weight: bold;
    text-align: center;
}

body {
    margin: 0;
    height: 100vh;
   overflow-x: hidden;
    overflow-y: auto;
    font-family: 'Orbitron', sans-serif;
    background: black;
}


.choices-background {
    position: cover;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('choices.png') center/cover no-repeat;
    filter: blur(10px) brightness(0.6);
    transition: filter 0.6s ease;
}

/* Hover effect: reduce blur but keep clipped "bits" */
.choices-background:hover {
    filter: blur(0.5px) brightness(0.8);
}

/* When fully revealed (JS adds this class) */
.full-reveal {
    filter: none !important;
    clip-path: none !important;
}

/* Title in middle */
.site-title {
    text-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
    z-index: 2;
    transition: color 0.3s ease;
}

.site-title:hover {
    color: #ffffff;
}

</style>

</style>

<section class="instructions">
  <h2>Make Your Choices</h2>
  <p>
    In this quiz, you will face 10 important questions about how the city should run.  
    Each decision you make will shape the future of your world.  
    At the end, you’ll discover whether you built a bright Utopian city…  
    or let it slip into a dark Dystopian future.
  </p>
</section>

<style>
.instructions {
  text-align: center;
  max-width: 1000px;
  margin: 3rem auto;
  max-width: 700px;     /* maximum width */
  min-width: 1300px;     /* optional minimum width */
  height: 350px;        /* fixed height */
  min-height: 200px;    /* ensures it doesn't shrink too much */
  padding: 2.5rem 3rem;
  position: relative;
  border-radius: 25px;
  border: 2px solid #000000;
  background: linear-gradient(135deg, rgba(0,255,255,0.1), rgba(0,191,255,0.1));
  backdrop-filter: blur(15px);
  box-shadow: 0 0 30px #00eaff, 0 0 60px #00c6ff, 0 0 90px #0072ff;
  color: #fff;
  font-size: 1.2rem;
  line-height: 1.6;
  animation: glow 1.5s infinite alternate;
  margin: 4rem auto 4.5rem auto;
}

/* Glowing animation */
@keyframes glow {
  0% { box-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000, 0 0 60px #ff0000; }
  100% { box-shadow: 0 0 35px #00eaff, 0 0 70px #00c6ff, 0 0 100px #0072ff; }
}


/* Futuristic heading */
.instructions h2 {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  color: #ffffff;
  text-transform: uppercase;
  letter-spacing: 3px;
  text-shadow: 0 0 10px #000000, 0 0 20px #00c6ff, 0 0 30px #000000;
}

/* Optional subtle background pattern */
.instructions::before {
  content: "";
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: repeating-linear-gradient(
    45deg,
    rgba(255,255,255,0.02),
    rgba(255,255,255,0.02) 1px,
    transparent 1px,
    transparent 10px
  );
  border-radius: 25px;
  pointer-events: none;
}
</style>

<style>
/* General Reset */
* {margin:0; padding:0; box-sizing:border-box; font-family: 'Arial', sans-serif;}
body {background: #111; color: #fff; min-height:100vh;}

/* Section */
.choices-section { padding: 50px 20px; max-width: 900px; margin: auto; }
h1 {text-align:center; font-size: 3rem; color:#00bfff; margin-bottom: 20px; text-shadow: 0 0 15px #00bfff;}
p.intro {text-align:center; margin-bottom: 40px; font-size:1.2rem; color:#d0d0d0;}

/* Quiz Card */
.question-card {
  background: rgba(20, 191, 255, 0.05);
  border: 1px solid #ffffff;
  border-radius: 15px;
  padding: 25px;
  margin-bottom: 25px;
  transition: 0.3s;
  display: none; /* hide all initially */
}
.question-card.active { display: block; } /* show current question */
.question-card:hover {background: rgba(0, 191, 255, 0.1);}
.question-card h3 {margin-bottom: 15px; color:#00ffff;}
.options {display:flex; flex-direction: column; gap: 10px;}
.options label {
  background: rgba(255,255,255,0.1);
  padding: 10px 15px;
  border-radius: 10px;
  cursor:pointer;
  transition: 0.2s;
}
.options input {margin-right: 10px;}
.options label:hover {background: rgba(0,191,255,0.2);}

/* Navigation Buttons */
.navigation {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}
.navigation button {
  padding: 10px 20px;
  font-size: 1.1rem;
  border:none;
  border-radius: 30px;
  cursor:pointer;
  background: linear-gradient(135deg, #00c6ff, #0072ff);
  color:white;
  box-shadow:0 4px 15px rgba(0,114,255,0.3);
  transition:0.3s;
}
.navigation button:hover {transform:scale(1.05);}
.navigation button:disabled {opacity:0.5; cursor:default;}

/* Result Modal */
.modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:#111; padding:30px; border-radius:20px; text-align:center; width: 80%; max-width:600px; box-shadow:0 0 30px #00bfff; position:relative; }
.close-btn { position:absolute; top:15px; right:20px; font-size:1.5rem; cursor:pointer; color:#fff; }
.modal h2 {color:#00ffff; margin-bottom:20px;}
.chart-bar-container { display:flex; justify-content: space-between; margin-top: 30px; gap:20px; }
.chart-bar { width:45%; background: rgba(0,191,255,0.1); border-radius:10px; overflow:hidden; height: 30px; position:relative; }
.chart-fill { background: #00ffff; height: 100%; width:0%; transition: width 1s; }
.chart-label { position:absolute; width:100%; text-align:center; top:0; left:0; color:#ffffffb9; font-weight:bold; line-height:30px; }
</style>

</head>
<body>

<section class="choices-section">
    <h1>Shape Your AI City</h1>
    <p class="intro">Answer these 10 questions to decide whether your city becomes a Utopian paradise or a Dystopian nightmare!</p>

    <form id="quizForm">
        <!-- Question Cards -->
        <div class="question-card active">
            <h3>1. How should AI manage healthcare?</h3>
            <div class="options">
                <label><input type="radio" name="q1" value="utopia" required>AI ensures personalized care for everyone.</label>
                <label><input type="radio" name="q1" value="dystopia">AI prioritizes only profitable patients.</label>
                <label><input type="radio" name="q1" value="utopia">AI provides equal access for all citizens.</label>
                <label><input type="radio" name="q1" value="dystopia">AI decides care based on profit efficiency.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>2. How should AI monitor safety?</h3>
            <div class="options">
                <label><input type="radio" name="q2" value="utopia" required>AI protects citizens and prevents crimes.</label>
                <label><input type="radio" name="q2" value="dystopia">AI constantly spies on everyone.</label>
                <label><input type="radio" name="q2" value="utopia">AI intervenes only when necessary to help.</label>
                <label><input type="radio" name="q2" value="dystopia">AI controls citizens' daily routines.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>3. How should AI control education?</h3>
            <div class="options">
                <label><input type="radio" name="q3" value="utopia" required>AI customizes learning for every student.</label>
                <label><input type="radio" name="q3" value="dystopia">AI forces strict rules on all students.</label>
                <label><input type="radio" name="q3" value="utopia">AI supports creative and flexible learning.</label>
                <label><input type="radio" name="q3" value="dystopia">AI monitors students constantly.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>4. How should AI manage traffic?</h3>
            <div class="options">
                <label><input type="radio" name="q4" value="utopia" required>AI optimizes roads to reduce accidents.</label>
                <label><input type="radio" name="q4" value="dystopia">AI restricts movement and tracks citizens.</label>
                <label><input type="radio" name="q4" value="utopia">AI plans efficient public transport.</label>
                <label><input type="radio" name="q4" value="dystopia">AI imposes strict travel limits.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>5. How should AI handle resources?</h3>
            <div class="options">
                <label><input type="radio" name="q5" value="utopia" required>AI distributes resources fairly to everyone.</label>
                <label><input type="radio" name="q5" value="dystopia">AI hoards resources for the elite.</label>
                <label><input type="radio" name="q5" value="utopia">AI ensures no one is left without essentials.</label>
                <label><input type="radio" name="q5" value="dystopia">AI gives priority to powerful groups.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>6. How should AI regulate energy?</h3>
            <div class="options">
                <label><input type="radio" name="q6" value="utopia" required>AI ensures clean and sustainable energy.</label>
                <label><input type="radio" name="q6" value="dystopia">AI gives power only to certain sectors.</label>
                <label><input type="radio" name="q6" value="utopia">AI reduces pollution and waste.</label>
                <label><input type="radio" name="q6" value="dystopia">AI restricts energy for the public.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>7. How should AI influence jobs?</h3>
            <div class="options">
                <label><input type="radio" name="q7" value="utopia" required>AI creates opportunities for all workers.</label>
                <label><input type="radio" name="q7" value="dystopia">AI automates jobs and leaves many unemployed.</label>
                <label><input type="radio" name="q7" value="utopia">AI helps people learn new skills.</label>
                <label><input type="radio" name="q7" value="dystopia">AI favors only high-paying sectors.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>8. How should AI control public spaces?</h3>
            <div class="options">
                <label><input type="radio" name="q8" value="utopia" required>AI ensures safety but respects freedom.</label>
                <label><input type="radio" name="q8" value="dystopia">AI forbids gatherings and monitors constantly.</label>
                <label><input type="radio" name="q8" value="utopia">AI manages spaces for comfort and access.</label>
                <label><input type="radio" name="q8" value="dystopia">AI restricts movement in public areas.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>9. How should AI manage communication?</h3>
            <div class="options">
                <label><input type="radio" name="q9" value="utopia" required>AI helps people connect safely and freely.</label>
                <label><input type="radio" name="q9" value="dystopia">AI censors and monitors messages.</label>
                <label><input type="radio" name="q9" value="utopia">AI prevents online harm while allowing freedom.</label>
                <label><input type="radio" name="q9" value="dystopia">AI controls all digital communication.</label>
            </div>
        </div>

        <div class="question-card">
            <h3>10. How should AI handle governance?</h3>
            <div class="options">
                <label><input type="radio" name="q10" value="utopia" required>AI supports democracy and citizen participation.</label>
                <label><input type="radio" name="q10" value="dystopia">AI enforces strict control over everyone.</label>
                <label><input type="radio" name="q10" value="utopia">AI advises leaders transparently.</label>
                <label><input type="radio" name="q10" value="dystopia">AI ignores citizen input.</label>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="navigation">
            <button type="button" id="prevBtn" disabled>&larr; Previous</button>
            <button type="button" id="nextBtn">Next &rarr;</button>
        </div>
    </form>
</section>

<!-- Result Modal -->
<div class="modal" id="resultModal">
    <div class="modal-content">
        <span class="close-btn" id="closeModal">&times;</span>
        <h2>Your AI City Result</h2>
        <p id="resultText"></p>
        <div class="chart-bar-container">
            <div class="chart-bar">
                <div class="chart-fill" id="utopiaBar"></div>
                <div class="chart-label">Utopia</div>
            </div>
            <div class="chart-bar">
                <div class="chart-fill" id="dystopiaBar"></div>
                <div class="chart-label">Dystopia</div>
            </div>
        </div>
    </div>
</div>

<script>
const slides = document.querySelectorAll('.question-card');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const modal = document.getElementById('resultModal');
const closeModal = document.getElementById('closeModal');
const resultText = document.getElementById('resultText');
const utopiaBar = document.getElementById('utopiaBar');
const dystopiaBar = document.getElementById('dystopiaBar');

let currentSlide = 0;
let utopiaScore = 0;
let dystopiaScore = 0;

function showSlide(index){
    slides.forEach((slide,i) => slide.classList.toggle('active', i===index));
    prevBtn.disabled = index===0;
    nextBtn.textContent = index === slides.length-1 ? 'Submit' : 'Next →';
}
showSlide(currentSlide);

nextBtn.addEventListener('click', ()=>{
    const selected = slides[currentSlide].querySelector('input[type="radio"]:checked');
    if(!selected){ alert("Please select an option."); return; }

    if(selected.value==='utopia') utopiaScore++;
    else dystopiaScore++;

    if(currentSlide < slides.length-1){
        currentSlide++;
        showSlide(currentSlide);
    } else {
        // Show results
        let resultMessage = '';
        if(utopiaScore > dystopiaScore){
            resultMessage = `You built a bright Utopian city with ${utopiaScore} Utopia points!`;
        } else if(dystopiaScore > utopiaScore){
            resultMessage = `Your city slipped into a Dystopian future with ${dystopiaScore} Dystopia points.`;
        } else {
            resultMessage = `Your city is balanced! ${utopiaScore} Utopia points and ${dystopiaScore} Dystopia points.`;
        }
        resultText.textContent = resultMessage;
        utopiaBar.style.width = (utopiaScore*10)+'%';
        dystopiaBar.style.width = (dystopiaScore*10)+'%';
        modal.style.display = 'flex';
    }
});

prevBtn.addEventListener('click', ()=>{
    if(currentSlide>0){
        currentSlide--;
        showSlide(currentSlide);
    }
});

closeModal.addEventListener('click', ()=>{ modal.style.display='none'; });
window.addEventListener('click', e => { if(e.target === modal) modal.style.display='none'; });


</script>

<!-- 🔹 Chatbot Floating Widget -->
<div id="chatbot-widget">
  <!-- Toggle Button -->
  <button id="chatbot-toggle">💬</button>

  <!-- Chatbot Window -->
  <div class="chatbot-window">
    <div class="container">
      <!-- App Header -->
      <header class="app-header">
        <h1 class="heading">Hello, there</h1>
        <h4 class="sub-heading">How can I help you today?</h4>
      </header>

      <!-- Chats -->
      <div class="chats-container"></div>

      <!-- Prompt Input -->
      <div class="prompt-container">
        <div class="prompt-wrapper">
          <form action="#" class="prompt-form">
            <input type="text" placeholder="Ask Gemini" class="prompt-input" required />
            <div class="prompt-actions">
              <!-- File Upload Wrapper -->
              
        
      </div>
    </div>
  </div>
</div>

<style>
/* 🔹 Floating Chatbot Styles */
#chatbot-widget {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 99999;
  font-family: "Poppins", sans-serif;
}

/* Small toggle button */
#chatbot-toggle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: none;
  background: #1d7efd;
  color: #fff;
  font-size: 28px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  transition: transform 0.3s ease;
}
#chatbot-toggle:hover {
  transform: scale(1.1);
}

/* Chat window hidden by default */
.chatbot-window {
  display: none;
  width: 380px;
  height: 600px;
  background: var(--primary-color);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
  position: fixed;
  bottom: 90px;
  right: 20px;
}

/* When open */
#chatbot-widget.active .chatbot-window {
  display: block;
}

/* 🔹 Keep your existing chatbot styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Poppins", sans-serif;
}
:root {
  --text-color: #edf3ff;
  --subheading-color: #97a7ca;
  --placeholder-color: #c3cdde;
  --primary-color: #101623;
  --secondary-color: #283045;
  --secondary-hover-color: #333e58;
  --scrollbar-color: #626a7f;
}
body.light-theme {
  --text-color: #090c13;
  --subheading-color: #7b8cae;
  --placeholder-color: #606982;
  --primary-color: #f3f7ff;
  --secondary-color: #dce6f9;
  --secondary-hover-color: #d2ddf2;
  --scrollbar-color: #a2aac2;
}
body {
  color: var(--text-color);
  background: var(--primary-color);
}
.container {
  overflow-y: auto;
  padding: 32px 0 60px;
  height: 100%;
  scrollbar-color: var(--scrollbar-color) transparent;
}
.app-header {
  margin-bottom: 40px;
  padding: 0 24px;
  text-align: center;
}
.heading {
  font-size: 28px;
  font-weight: 600;
  margin-bottom: 8px;
  color: white;
  text-shadow: none;
}
.sub-heading {
  font-size: 16px;
  font-weight: 400;
  color: var(--subheading-color);
}
.chats-container {
  padding: 0 24px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.chats-container .chat {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.chats-container .chat:last-child .chat-bubble {
  border-bottom-right-radius: 4px;
}
.chats-container .chat.ai .chat-bubble {
  border-bottom-left-radius: 4px;
}
.chats-container .chat.user {
  align-items: flex-end;
}
.chats-container .chat.user .chat-bubble {
  background: #3a496b;
  color: #fff;
}
.chat-bubble {
  max-width: 80%;
  background: var(--secondary-color);
  border-radius: 4px;
  border-bottom-left-radius: 4px;
  padding: 12px 16px;
  font-size: 15px;
  font-weight: 400;
  line-height: 1.4;
  word-break: break-word;
}
.chat-bubble img {
  max-width: 100%;
  border-radius: 4px;
  margin-top: 8px;
}
.chat-bubble .file-link {
  display: inline-block;
  margin-top: 8px;
  color: #1d7efd;
  text-decoration: none;
}
.chat-bubble .file-link:hover {
  text-decoration: underline;
}
.chat-status {
  font-size: 13px;
  color: var(--subheading-color);
}
.prompt-container {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  padding: 24px;
  background: var(--primary-color);
  border-top: 1px solid var(--secondary-color);
}
.prompt-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}
.prompt-form {
  position: relative;
  width: 100%;
}
.prompt-input {
  width: 100%;
  border: none;
  background: var(--secondary-color);
  border-radius: 12px;
  padding: 14px 72px 14px 20px;
  font-size: 15px;
  color: var(--text-color);
  outline: none;
  caret-color: var(--text-color);
}
.prompt-input::placeholder {
  color: var(--placeholder-color);
}
.prompt-actions {
  position: absolute;
  top: 50%;
  right: 12px;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  gap: 8px;
}
.prompt-actions button {
  width: 40px;
  height: 40px;
  border: none;
  border-radius: 50%;
  background: var(--secondary-color);
  color: var(--text-color);
  font-size: 20px;
  cursor: pointer;
  display: grid;
  place-content: center;
  transition: background 0.2s ease;
}
.prompt-actions button:hover {
  background: var(--secondary-hover-color);
}
.file-upload-wrapper {
  position: absolute;
  top: -50px;
  left: 0;
  display: flex;
  align-items: center;
  gap: 12px;
}
.file-upload-wrapper img {
  width: 40px;
  height: 40px;
  border-radius: 4px;
  object-fit: cover;
}
.file-upload-wrapper input[type="file"] {
  display: none;
}
.file-upload-wrapper button {
  width: 32px;
  height: 32px;
  border: none;
  border-radius: 50%;
  background: var(--secondary-color);
  color: var(--text-color);
  font-size: 16px;
  cursor: pointer;
  display: grid;
  place-content: center;
  transition: background 0.2s ease;
}
.file-upload-wrapper button:hover {
  background: var(--secondary-hover-color);
}
#theme-toggle-btn,
#delete-chats-btn {
  position: absolute;
  top: 50%;
  right: 0;
  transform: translateY(-50%);
  width: 48px;
  height: 48px;
  border: none;
  border-radius: 50%;
  background: transparent;
  color: var(--subheading-color);
  font-size: 24px;
  cursor: pointer;
  transition: color 0.2s ease;
}
#theme-toggle-btn:hover,
#delete-chats-btn:hover {
  color: var(--text-color);
}
#theme-toggle-btn {
  right: 56px;
}
.disclaimer-text {
  margin-top: 26px;
  font-size: 13px;
  color: var(--subheading-color);
}
/* Hide scrollbar for Chrome, Safari and Opera */
.container::-webkit-scrollbar {
  width: 6px;
}
.container::-webkit-scrollbar-track {
  background: transparent;
}
.container::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-color);
  border-radius: 6px;
  border: 1px solid transparent;
}
/* Hide scrollbar for IE, Edge and Firefox */
.container {
  -ms-overflow-style: none;
  scrollbar-width: thin;
}
/* Media Queries */
@media screen and (max-width: 768px) {
  .chatbot-window {
    width: 90%;
    max-width: 400px;
    height: 80vh;
    bottom: 20px;
    right: 10px;
    left: 10px;
    margin: 0 auto;
  }
  #chatbot-widget {
    bottom: 10px;
    right: 10px;
  }
}
</style>

<script>
/* 🔹 Toggle Widget Open/Close */
const widget = document.getElementById("chatbot-widget");
const toggleBtn = document.getElementById("chatbot-toggle");
toggleBtn.addEventListener("click", () => {
  widget.classList.toggle("active");
});

/* 🔹 Your Gemini Chatbot JS */
const container = document.querySelector(".container");
const chatsContainer = document.querySelector(".chats-container");
const promptForm = document.querySelector(".prompt-form");
const promptInput = promptForm.querySelector(".prompt-input");
const fileInput = promptForm.querySelector("#file-input");
const fileUploadWrapper = promptForm.querySelector(".file-upload-wrapper");
const themeToggleBtn = document.querySelector("#theme-toggle-btn");
const deleteChatsBtn = document.querySelector("#delete-chats-btn");
const sendPromptBtn = document.querySelector("#send-prompt-btn");
const stopResponseBtn = document.querySelector("#stop-response-btn");
const fileIconBtn = document.querySelector(".file-icon");
const cancelFileBtn = document.querySelector("#cancel-file-btn");
const addFileBtn = document.querySelector("#add-file-btn");
const filePreview = document.querySelector(".file-preview");

// API Setup
const API_KEY = "AIzaSyAvUT6g97pWqAsfm0WpEOzrDwB4vX8KWqU"; // 🔹 Replace this with your Gemini API key
const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

let controller, typingInterval;
const chatHistory = [];
const userData = { message: "", file: {} };

// Function to create a chat bubble
const createChatBubble = (message, type, file = null) => {
  const chat = document.createElement("div");
  chat.classList.add("chat", type);

  const chatBubble = document.createElement("div");
  chatBubble.classList.add("chat-bubble");
  chatBubble.textContent = message;

  if (file) {
    if (file.type.startsWith("image/")) {
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      chatBubble.appendChild(img);
    } else {
      const fileLink = document.createElement("a");
      fileLink.href = URL.createObjectURL(file);
      fileLink.textContent = `Download ${file.name}`;
      fileLink.classList.add("file-link");
      chatBubble.appendChild(fileLink);
    }
  }

  chat.appendChild(chatBubble);
  return chat;
};

// Function to display a typing indicator
const showTypingIndicator = () => {
  const chat = document.createElement("div");
  chat.classList.add("chat", "ai");

  const chatBubble = document.createElement("div");
  chatBubble.classList.add("chat-bubble");
  chatBubble.textContent = "..."; // Typing indicator

  chat.appendChild(chatBubble);
  chatsContainer.appendChild(chat);
  scrollToBottom();
};

// Function to handle the Gemini API response
const handleGeminiResponse = async (response) => {
  try {
    const data = await response.json();
    if (data.error) {
      throw new Error(data.error.message);
    }

    const content = data.candidates[0].content.parts[0].text;
    return content;
  } catch (error) {
    console.error("Gemini API Error:", error);
    return `Error: ${error.message}`;
  }
};

// Function to simulate typing effect
const typeText = (element, text, callback) => {
  let index = 0;
  typingInterval = setInterval(() => {
    if (index < text.length) {
      element.textContent += text.charAt(index);
      index++;
      scrollToBottom();
    } else {
      clearInterval(typingInterval);
      callback();
    }
  }, 20);
};

// Function to add AI chat to the container
const addAiChat = async (message, file = null) => {
  const aiChat = createChatBubble("...", "ai");
  chatsContainer.appendChild(aiChat);
  scrollToBottom();

  let geminiResponse;
  try {
    controller = new AbortController();

    const requestOptions = {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        contents: [
          {
            parts: [{ text: message }],
          },
        ],
      }),
      signal: controller.signal,
    };

    const response = await fetch(API_URL, requestOptions);
    geminiResponse = await handleGeminiResponse(response);
  } catch (error) {
    geminiResponse = `Error: ${error.message}`;
  }

  chatsContainer.removeChild(aiChat);
  const newAiChat = createChatBubble("", "ai");
  chatsContainer.appendChild(newAiChat);
  scrollToBottom();

  typeText(newAiChat.querySelector(".chat-bubble"), geminiResponse, () => {});
};

// Function to add user chat to the container
const addUserChat = (message, file = null) => {
  const userChat = createChatBubble(message, "user", file);
  chatsContainer.appendChild(userChat);
  scrollToBottom();
};

// Function to handle form submission
const handleFormSubmit = async (e) => {
  e.preventDefault();
  const message = promptInput.value.trim();
  if (!message && !userData.file.name) return;

  addUserChat(message, userData.file.name ? userData.file : null);
  addAiChat(message, userData.file.name ? userData.file : null);

  chatHistory.push({ type: "user", message, file: userData.file });
  promptInput.value = "";
  userData.message = "";
  userData.file = {};
  filePreview.src = "";
  filePreview.style.display = "none"; // hide preview when cleared
  fileUploadWrapper.classList.remove("active");
};

// Function to scroll to the bottom of the chats container
const scrollToBottom = () => {
  container.scrollTop = container.scrollHeight;
};

// Function to toggle theme
const toggleTheme = () => {
  document.body.classList.toggle("light-theme");
};

// Function to delete all chats
const deleteChats = () => {
  chatsContainer.innerHTML = "";
  chatHistory.length = 0;
};

// Function to handle file selection
const handleFileSelect = (e) => {
  const file = e.target.files[0];
  if (!file) return;

  userData.file = file;
  filePreview.src = URL.createObjectURL(file);
  filePreview.style.display = "block"; // show only when a file exists
  fileUploadWrapper.classList.add("active");
};

// Event Listeners
promptForm.addEventListener("submit", handleFormSubmit);
themeToggleBtn.addEventListener("click", toggleTheme);
deleteChatsBtn.addEventListener("click", deleteChats);
fileInput.addEventListener("change", handleFileSelect);
cancelFileBtn.addEventListener("click", () => {
  userData.file = {};
  filePreview.src = "";
  filePreview.style.display = "none";
  fileUploadWrapper.classList.remove("active");
  fileInput.value = ""; // Reset the file input
});

stopResponseBtn.addEventListener("click", () => {
  if (controller) {
    controller.abort();
    clearInterval(typingInterval);
  }
});
</script>


</body>
</html>